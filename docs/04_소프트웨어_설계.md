# ğŸ“˜ Study 2: ì„¤ê³„ í”„ë¡œì„¸ìŠ¤ & ë””ìì¸ íŒ¨í„´

**í•™ìŠµ ëª©í‘œ**: í™•ì¥ ê°€ëŠ¥í•˜ê³  ìœ ì§€ë³´ìˆ˜ ì‰¬ìš´ ë°±ì—”ë“œ ì„¤ê³„

---

## ğŸ“– ëª©ì°¨

1. [ì„¤ê³„ í”„ë¡œì„¸ìŠ¤](#1-ì„¤ê³„-í”„ë¡œì„¸ìŠ¤)
2. [ë‹¤ì´ì–´ê·¸ë¨ìœ¼ë¡œ ì„¤ê³„í•˜ê¸°](#2-ë‹¤ì´ì–´ê·¸ë¨ìœ¼ë¡œ-ì„¤ê³„í•˜ê¸°)
3. [ë””ìì¸ íŒ¨í„´](#3-ë””ìì¸-íŒ¨í„´)
4. [ì‹¤ì „ êµ¬í˜„ ì˜ˆì œ](#4-ì‹¤ì „-êµ¬í˜„-ì˜ˆì œ)

---

## 1. ì„¤ê³„ í”„ë¡œì„¸ìŠ¤

### ë°±ì—”ë“œ ì„¤ê³„ ë‹¨ê³„

```mermaid
flowchart LR
    A[ìš”êµ¬ì‚¬í•­ ë¶„ì„] --> B[API ì„¤ê³„]
    B --> C[DB ìŠ¤í‚¤ë§ˆ ì„¤ê³„]
    C --> D[ì•„í‚¤í…ì²˜ ê²°ì •]
    D --> E[êµ¬í˜„]
    E --> F[í…ŒìŠ¤íŠ¸]
```

#### 1ë‹¨ê³„: ìš”êµ¬ì‚¬í•­ ë¶„ì„

**ì§ˆë¬¸**:
- ëˆ„ê°€ ì‚¬ìš©í•˜ë‚˜? (ì‚¬ìš©ì íƒ€ì…)
- ë¬´ì—‡ì„ í•˜ë‚˜? (í•µì‹¬ ê¸°ëŠ¥)
- ì–¼ë§ˆë‚˜ ë§ì´? (ì˜ˆìƒ íŠ¸ë˜í”½)
- ì–¼ë§ˆë‚˜ ë¹ ë¥´ê²Œ? (ì„±ëŠ¥ ìš”êµ¬ì‚¬í•­)

**ì˜ˆì‹œ**:
```
í”„ë¡œì íŠ¸: ë¸”ë¡œê·¸ ì‹œìŠ¤í…œ
ì‚¬ìš©ì: ì¼ë°˜ ì‚¬ìš©ì, ì‘ì„±ì, ê´€ë¦¬ì
ì£¼ìš” ê¸°ëŠ¥:
  - ê¸€ ì‘ì„±/ìˆ˜ì •/ì‚­ì œ
  - ëŒ“ê¸€ ë‹¬ê¸°
  - ì¢‹ì•„ìš”
ì˜ˆìƒ íŠ¸ë˜í”½: DAU 10,000ëª…
ì„±ëŠ¥: í‰ê·  ì‘ë‹µ ì‹œê°„ < 200ms
```

#### 2ë‹¨ê³„: API ì„¤ê³„

**RESTful API ì„¤ê³„ ì›ì¹™**:

```python
# [ì˜¬ë°”ë¥¸ ì˜ˆ]
GET    /api/posts          # ê¸€ ëª©ë¡
GET    /api/posts/123      # íŠ¹ì • ê¸€
POST   /api/posts          # ê¸€ ì‘ì„±
PUT    /api/posts/123      # ê¸€ ìˆ˜ì •
DELETE /api/posts/123      # ê¸€ ì‚­ì œ

# [ì˜ëª»ëœ ì˜ˆ]
GET /api/getPost?id=123    # âŒ ë™ì‚¬ ì‚¬ìš©
POST /api/post/delete/123  # âŒ DELETE ì¨ì•¼ í•¨
```

**API ëª…ì„¸ì„œ ì‘ì„±**:

```python
"""
API: ê²Œì‹œê¸€ ì‘ì„±
Method: POST /api/posts
Headers:
  Authorization: Bearer {token}
  Content-Type: application/json

Request Body:
  {
    "title": "ì œëª©",
    "content": "ë‚´ìš©",
    "tags": ["python", "fastapi"]
  }

Response (201 Created):
  {
    "id": 123,
    "title": "ì œëª©",
    "created_at": "2024-01-01T00:00:00Z"
  }

Errors:
  400: ì œëª©ì´ ë¹„ì–´ìˆìŒ
  401: ì¸ì¦ ì‹¤íŒ¨
  500: ì„œë²„ ì—ëŸ¬
"""
```

#### 3ë‹¨ê³„: DB ìŠ¤í‚¤ë§ˆ ì„¤ê³„

**ì •ê·œí™” (Normalization)**:

```sql
-- [1NF] ë°˜ë³µ ê·¸ë£¹ ì œê±°
CREATE TABLE posts (
    id INT PRIMARY KEY,
    title VARCHAR(100),
    content TEXT,
    author_id INT,
    tags VARCHAR(255)  -- âŒ ì‰¼í‘œë¡œ êµ¬ë¶„ëœ ë¬¸ìì—´
);

-- [2NF] ë¶€ë¶„ ì¢…ì† ì œê±°
CREATE TABLE posts (
    id INT PRIMARY KEY,
    title VARCHAR(100),
    content TEXT,
    author_id INT
);

CREATE TABLE post_tags (  -- âœ… ë³„ë„ í…Œì´ë¸”
    post_id INT,
    tag_name VARCHAR(50),
    PRIMARY KEY (post_id, tag_name)
);

-- [3NF] ì´í–‰ ì¢…ì† ì œê±°
CREATE TABLE users (
    id INT PRIMARY KEY,
    name VARCHAR(50),
    department_id INT  -- âœ… ë¶€ì„œ IDë§Œ ì €ì¥
);

CREATE TABLE departments (
    id INT PRIMARY KEY,
    name VARCHAR(50)
);
```

**ì¸ë±ìŠ¤ ì„¤ê³„**:

```sql
-- ìì£¼ ì¡°íšŒí•˜ëŠ” ì»¬ëŸ¼ì— ì¸ë±ìŠ¤
CREATE INDEX idx_posts_author ON posts(author_id);
CREATE INDEX idx_posts_created ON posts(created_at);

-- ë³µí•© ì¸ë±ìŠ¤
CREATE INDEX idx_posts_search ON posts(author_id, created_at);
```

---

## 2. ë‹¤ì´ì–´ê·¸ë¨ìœ¼ë¡œ ì„¤ê³„í•˜ê¸°

### ER Diagram (Entity-Relationship)

```mermaid
erDiagram
    USER ||--o{ POST : writes
    POST ||--o{ COMMENT : has
    POST }o--o{ TAG : has
    USER ||--o{ COMMENT : writes
    
    USER {
        int id PK
        string email UK
        string password_hash
        datetime created_at
    }
    
    POST {
        int id PK
        int author_id FK
        string title
        text content
        datetime created_at
    }
    
    COMMENT {
        int id PK
        int post_id FK
        int user_id FK
        text content
        datetime created_at
    }
    
    TAG {
        int id PK
        string name UK
    }
```

### Sequence Diagram (ì‹œí€€ìŠ¤)

```mermaid
sequenceDiagram
    participant C as Client
    participant A as API Server
    participant D as Database
    participant R as Redis Cache
    
    C->>A: GET /api/posts/123
    A->>R: Check cache
    
    alt Cache Hit
        R-->>A: Return cached data
        A-->>C: 200 OK (ë¹ ë¦„!)
    else Cache Miss
        R-->>A: Not found
        A->>D: SELECT * FROM posts WHERE id=123
        D-->>A: Return data
        A->>R: Store in cache
        A-->>C: 200 OK
    end
```

---

## 3. ë””ìì¸ íŒ¨í„´

### 1. Singleton (ì‹±ê¸€í†¤)

**ì–¸ì œ**: DB ì—°ê²°, ì„¤ì • ê°ì²´

```python
"""
Singleton Pattern - DB ì—°ê²° ê´€ë¦¬

ğŸ”— ì°¸ê³ : https://refactoring.guru/design-patterns/singleton
"""

class DatabaseConnection:
    _instance = None
    
    def __new__(cls):
        """
        __new__: ê°ì²´ ìƒì„± ì‹œ í˜¸ì¶œ
        ì´ë¯¸ ì¸ìŠ¤í„´ìŠ¤ê°€ ìˆìœ¼ë©´ ê·¸ê±¸ ë°˜í™˜
        """
        if cls._instance is None:
            cls._instance = super().__new__(cls)
            # ì‹¤ì œ DB ì—°ê²°
            cls._instance.connection = create_engine("mysql://...")
        return cls._instance

# ì‚¬ìš©
db1 = DatabaseConnection()
db2 = DatabaseConnection()
assert db1 is db2  # âœ… ê°™ì€ ê°ì²´!
```

### 2. Factory (íŒ©í† ë¦¬)

**ì–¸ì œ**: ê°ì²´ ìƒì„± ë¡œì§ì´ ë³µì¡í•  ë•Œ

```python
"""
Factory Pattern - ì•Œë¦¼ ì‹œìŠ¤í…œ

ë‹¤ì–‘í•œ ì•Œë¦¼ ë°©ì‹(ì´ë©”ì¼, SMS, í‘¸ì‹œ)ì„ í†µí•© ê´€ë¦¬
"""

from abc import ABC, abstractmethod

# [ì¸í„°í˜ì´ìŠ¤]
class Notification(ABC):
    @abstractmethod
    def send(self, message: str):
        pass

# [êµ¬í˜„ì²´ë“¤]
class EmailNotification(Notification):
    def send(self, message: str):
        print(f"ğŸ“§ ì´ë©”ì¼ ë°œì†¡: {message}")
        # ì‹¤ì œë¡œëŠ” SMTPë¡œ ë°œì†¡

class SMS Notification(Notification):
    def send(self, message: str):
        print(f"ğŸ“± SMS ë°œì†¡: {message}")
        # ì‹¤ì œë¡œëŠ” SMS API í˜¸ì¶œ

class PushNotification(Notification):
    def send(self, message: str):
        print(f"ğŸ”” í‘¸ì‹œ ë°œì†¡: {message}")
        # ì‹¤ì œë¡œëŠ” FCM ë“± ì‚¬ìš©

# [íŒ©í† ë¦¬]
class NotificationFactory:
    @staticmethod
    def create(notification_type: str) -> Notification:
        """
        íƒ€ì…ì— ë”°ë¼ ì ì ˆí•œ ì•Œë¦¼ ê°ì²´ ìƒì„±
        
        ìƒˆë¡œìš´ ì•Œë¦¼ ë°©ì‹ ì¶”ê°€ë„ ì‰¬ì›€!
        """
        if notification_type == "email":
            return EmailNotification()
        elif notification_type == "sms":
            return SMSNotification()
        elif notification_type == "push":
            return PushNotification()
        else:
            raise ValueError(f"Unknown type: {notification_type}")

# [ì‚¬ìš©]
def send_notification(user_preference: str, message: str):
    notifier = NotificationFactory.create(user_preference)
    notifier.send(message)

# ì˜ˆì‹œ
send_notification("email", "í™˜ì˜í•©ë‹ˆë‹¤!")
send_notification("push", "ìƒˆ ëŒ“ê¸€ì´ ë‹¬ë ¸ìŠµë‹ˆë‹¤")
```

### 3. Repository (ë¦¬í¬ì§€í† ë¦¬)

**ì–¸ì œ**: DB ì ‘ê·¼ ë¡œì§ ë¶„ë¦¬

```python
"""
Repository Pattern - ë°ì´í„° ì ‘ê·¼ ê³„ì¸µ

DB ì¿¼ë¦¬ë¥¼ í•œ ê³³ì— ëª¨ì•„ì„œ ê´€ë¦¬
ğŸ”— ì°¸ê³ : https://martinfowler.com/eaaCatalog/repository.html
"""

from typing import List, Optional
from sqlalchemy.orm import Session
from models import User

class UserRepository:
    """
    User í…Œì´ë¸” ì „ìš© Repository
    
    ì¥ì :
    1. DB ì¿¼ë¦¬ ë¡œì§ì„ í•œ ê³³ì— ëª¨ìŒ
    2. í…ŒìŠ¤íŠ¸ ì‹œ Mock êµì²´ ì‰¬ì›€
    3. ì½”ë“œ ì¬ì‚¬ìš©ì„± ì¦ê°€
    """
    
    def __init__(self, db: Session):
        self.db = db
    
    def find_by_id(self, user_id: int) -> Optional[User]:
        """IDë¡œ ìœ ì € ì°¾ê¸°"""
        return self.db.query(User).filter(User.id == user_id).first()
    
    def find_by_email(self, email: str) -> Optional[User]:
        """ì´ë©”ì¼ë¡œ ìœ ì € ì°¾ê¸°"""
        return self.db.query(User).filter(User.email == email).first()
    
    def find_all(self, skip: int = 0, limit: int = 100) -> List[User]:
        """ì „ì²´ ìœ ì € ì¡°íšŒ (í˜ì´ì§•)"""
        return self.db.query(User).offset(skip).limit(limit).all()
    
    def create(self, user: User) -> User:
        """ìœ ì € ìƒì„±"""
        self.db.add(user)
        self.db.commit()
        self.db.refresh(user)
        return user
    
    def update(self, user: User) -> User:
        """ìœ ì € ì—…ë°ì´íŠ¸"""
        self.db.commit()
        self.db.refresh(user)
        return user
    
    def delete(self, user: User) -> None:
        """ìœ ì € ì‚­ì œ"""
        self.db.delete(user)
        self.db.commit()

# [Controllerì—ì„œ ì‚¬ìš©]
@router.get("/users/{user_id}")
def get_user(user_id: int, db: Session = Depends(get_db)):
    repo = UserRepository(db)
    user = repo.find_by_id(user_id)
    
    if not user:
        raise HTTPException(status_code=404, detail="User not found")
    
    return user
```

### 4. Dependency Injection (ì˜ì¡´ì„± ì£¼ì…)

**ì–¸ì œ**: í…ŒìŠ¤íŠ¸ ê°€ëŠ¥í•œ ì½”ë“œ ì‘ì„±

```python
"""
Dependency Injection - ëŠìŠ¨í•œ ê²°í•©

ğŸ”— ì°¸ê³ : https://fastapi.tiangolo.com/tutorial/dependencies/
"""

# [ë‚˜ìœ ì˜ˆ] - ê°•í•œ ê²°í•©
class UserService:
    def __init__(self):
        self.db = SessionLocal()  # âŒ ì§ì ‘ ìƒì„±
        self.cache = Redis()      # âŒ ì§ì ‘ ìƒì„±
    
    def get_user(self, user_id):
        # í…ŒìŠ¤íŠ¸ ì‹œ ì‹¤ì œ DBì— ì ‘ê·¼!
        return self.db.query(User).filter(User.id == user_id).first()

# [ì¢‹ì€ ì˜ˆ] - ì˜ì¡´ì„± ì£¼ì…
class UserService:
    def __init__(self, db: Session, cache: Redis):
        """
        ì™¸ë¶€ì—ì„œ ì£¼ì…ë°›ìŒ
        í…ŒìŠ¤íŠ¸ ì‹œ Mock ê°ì²´ë¡œ êµì²´ ê°€ëŠ¥!
        """
        self.db = db
        self.cache = cache
    
    def get_user(self, user_id: int):
        # ìºì‹œ ë¨¼ì € í™•ì¸
        cached = self.cache.get(f"user:{user_id}")
        if cached:
            return cached
        
        # DBì—ì„œ ì¡°íšŒ
        user = self.db.query(User).filter(User.id == user_id).first()
        
        # ìºì‹œì— ì €ì¥
        self.cache.set(f"user:{user_id}", user, ex=3600)
        return user

# [FastAPIì—ì„œ ì‚¬ìš©]
def get_user_service(
    db: Session = Depends(get_db),
    cache: Redis = Depends(get_redis)
) -> UserService:
    return UserService(db, cache)

@router.get("/users/{user_id}")
def get_user(
    user_id: int,
    service: UserService = Depends(get_user_service)
):
    return service.get_user(user_id)
```

---

## 4. ì‹¤ì „ êµ¬í˜„ ì˜ˆì œ

### ì™„ì „í•œ 3ê³„ì¸µ ì•„í‚¤í…ì²˜

```python
"""
3-Tier Architecture êµ¬í˜„
Controller â†’ Service â†’ Repository

íŒŒì¼ êµ¬ì¡°:
project/
â”œâ”€â”€ controller/
â”‚   â””â”€â”€ user_controller.py
â”œâ”€â”€ services/
â”‚   â””â”€â”€ user_service.py
â””â”€â”€ repositories/
    â””â”€â”€ user_repository.py
"""

# ============ repositories/user_repository.py ============
from typing import Optional
from sqlalchemy.orm import Session
from models import User

class UserRepository:
    """ë°ì´í„° ì ‘ê·¼ ê³„ì¸µ (Data Access Layer)"""
    
    def __init__(self, db: Session):
        self.db = db
    
    def find_by_email(self, email: str) -> Optional[User]:
        return self.db.query(User).filter(User.email == email).first()
    
    def create(self, user: User) -> User:
        self.db.add(user)
        self.db.commit()
        self.db.refresh(user)
        return user


# ============ services/user_service.py ============
from passlib.hash import bcrypt

class UserService:
    """ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ê³„ì¸µ (Business Logic Layer)"""
    
    def __init__(self, repository: UserRepository):
        self.repository = repository
    
    def register_user(self, email: str, password: str) -> User:
        """
        íšŒì›ê°€ì… ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
        
        1. ì¤‘ë³µ ì²´í¬
        2. ë¹„ë°€ë²ˆí˜¸ í•´ì‹±
        3. ìœ ì € ìƒì„±
        """
        # ì¤‘ë³µ ì²´í¬
        existing = self.repository.find_by_email(email)
        if existing:
            raise ValueError("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì´ë©”ì¼ì…ë‹ˆë‹¤")
        
        # ë¹„ë°€ë²ˆí˜¸ í•´ì‹±
        hashed_password = bcrypt.hash(password)
        
        # ìœ ì € ìƒì„±
        user = User(email=email, password_hash=hashed_password)
        return self.repository.create(user)


# ============ controller/user_controller.py ============
from fastapi import APIRouter, Depends, HTTPException
from services.user_service import UserService
from repositories.user_repository import UserRepository

router = APIRouter(prefix="/api/users", tags=["users"])

def get_user_service(db: Session = Depends(get_db)) -> UserService:
    """ì˜ì¡´ì„± ì£¼ì…"""
    repository = UserRepository(db)
    return UserService(repository)

@router.post("/register")
def register(
    email: str,
    password: str,
    service: UserService = Depends(get_user_service)
):
    """
    í”„ë ˆì  í…Œì´ì…˜ ê³„ì¸µ (Presentation Layer)
    
    ì—­í• :
    1. HTTP ìš”ì²­ ë°›ê¸°
    2. Serviceì— ìœ„ì„
    3. HTTP ì‘ë‹µ ë°˜í™˜
    """
    try:
        user = service.register_user(email, password)
        return {"id": user.id, "email": user.email}
    except ValueError as e:
        raise HTTPException(status_code=400, detail=str(e))
```

---

## ğŸ“š ì¶”ê°€ í•™ìŠµ ìë£Œ

### ë””ìì¸ íŒ¨í„´
- [Refactoring Guru](https://refactoring.guru/design-patterns) - ìµœê³ ì˜ ë””ìì¸ íŒ¨í„´ í•™ìŠµ ì‚¬ì´íŠ¸
- [Design Patterns in Python](https://github.com/faif/python-patterns) - Python ì˜ˆì œ

### ì•„í‚¤í…ì²˜
- [12 Factor App](https://12factor.net/ko/) - ëª¨ë˜ ì•± ì„¤ê³„ ì›ì¹™
- [Clean Architecture](https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html)

---

**ë‹¤ìŒ í•™ìŠµ**: [study3.md - í…ŒìŠ¤íŠ¸, ìœ ì§€ë³´ìˆ˜, í”„ë¡œì íŠ¸ ê´€ë¦¬](./study3.md)

## ğŸ¯ ì˜¤ëŠ˜ì˜ ì‹¤ìŠµ ê³¼ì œ (Daily Challenges)

### Day 1: ERD ê·¸ë¦¬ê¸°
```python
"""
ê³¼ì œ: ë¸”ë¡œê·¸ ì‹œìŠ¤í…œ ERD ì§ì ‘ ê·¸ë¦¬ê¸°

í…Œì´ë¸”:
1. users (id, email, username)
2. posts (id, user_id, title, content)
3. comments (id, post_id, user_id, content)
4. tags (id, name)
5. post_tags (post_id, tag_id)

ë„êµ¬: dbdiagram.io ì‚¬ìš©
"""

# âœï¸ ì§ì ‘ í•´ë³´ê¸°:
# 1. https://dbdiagram.io/ ì ‘ì†
# 2. ìœ„ í…Œì´ë¸” ê´€ê³„ ì •ì˜
# 3. ìŠ¤í¬ë¦°ìƒ· ì €ì¥
```

### Day 2: Repository íŒ¨í„´ êµ¬í˜„
```python
"""
ê³¼ì œ: PostRepository ì™„ì„±í•˜ê¸°
"""

from typing import List, Optional
from sqlalchemy.orm import Session
from models import Post

class PostRepository:
    def __init__(self, db: Session):
        self.db = db
    
    # TODO: ì•„ë˜ ë©”ì„œë“œë“¤ì„ êµ¬í˜„í•˜ì„¸ìš”
    
    def find_by_id(self, post_id: int) -> Optional[Post]:
        """IDë¡œ ê²Œì‹œê¸€ ì°¾ê¸°"""
        pass  # ì—¬ê¸°ë¥¼ ì±„ìš°ì„¸ìš”!
    
    def find_all(self, skip: int = 0, limit: int = 10) -> List[Post]:
        """ì „ì²´ ê²Œì‹œê¸€ (í˜ì´ì§•)"""
        pass  # ì—¬ê¸°ë¥¼ ì±„ìš°ì„¸ìš”!
    
    def find_by_author(self, author_id: int) -> List[Post]:
        """ì‘ì„±ìë³„ ê²Œì‹œê¸€"""
        pass  # ì—¬ê¸°ë¥¼ ì±„ìš°ì„¸ìš”!
    
    def create(self, post: Post) -> Post:
        """ê²Œì‹œê¸€ ìƒì„±"""
        pass  # ì—¬ê¸°ë¥¼ ì±„ìš°ì„¸ìš”!
    
    def update(self, post: Post) -> Post:
        """ê²Œì‹œê¸€ ìˆ˜ì •"""
        pass  # ì—¬ê¸°ë¥¼ ì±„ìš°ì„¸ìš”!
    
    def delete(self, post: Post) -> None:
        """ê²Œì‹œê¸€ ì‚­ì œ"""
        pass  # ì—¬ê¸°ë¥¼ ì±„ìš°ì„¸ìš”!

# âœï¸ ì •ë‹µ ì˜ˆì‹œëŠ” study2_answers.mdì—ì„œ í™•ì¸!
```

### Day 3: Service Layer êµ¬í˜„
```python
"""
ê³¼ì œ: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ Serviceë¡œ ë¶„ë¦¬
"""

from repositories.post_repository import PostRepository

class PostService:
    def __init__(self, repository: PostRepository):
        self.repository = repository
    
    def create_post(self, title: str, content: str, author_id: int):
        """
        ê²Œì‹œê¸€ ìƒì„± ë¡œì§
        
        TODO: ì•„ë˜ ê²€ì¦ ë¡œì§ ì¶”ê°€
        1. ì œëª©ì€ 5ì ì´ìƒ
        2. ë‚´ìš©ì€ 10ì ì´ìƒ
        3. ìš•ì„¤ í•„í„°ë§
        """
        # ì—¬ê¸°ë¥¼ ì±„ìš°ì„¸ìš”!
        pass
```

---

## ğŸ“¦ ë””ìì¸ íŒ¨í„´ ì¶”ê°€ ë¼ì´ë¸ŒëŸ¬ë¦¬

### 1. Pydantic - ë°ì´í„° ê²€ì¦
```python
"""
ì´ë¯¸ FastAPIì— í¬í•¨ë˜ì–´ ìˆì§€ë§Œ, ë” ê¹Šì´ í™œìš©

ğŸ”— ê³µì‹ ë¬¸ì„œ: https://docs.pydantic.dev/
"""

from pydantic import BaseModel, validator, Field
from typing import List

class CreatePostRequest(BaseModel):
    """ê²Œì‹œê¸€ ìƒì„± ìš”ì²­"""
    title: str = Field(..., min_length=5, max_length=100)
    content: str = Field(..., min_length=10)
    tags: List[str] = Field(default=[])
    
    @validator('title')
    def title_no_special_chars(cls, v):
        """ì œëª©ì— íŠ¹ìˆ˜ë¬¸ì ê¸ˆì§€"""
        if not v.replace(' ', '').isalnum():
            raise ValueError('íŠ¹ìˆ˜ë¬¸ìëŠ” ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤')
        return v
    
    @validator('tags')
    def limit_tags(cls, v):
        """íƒœê·¸ëŠ” ìµœëŒ€ 5ê°œ"""
        if len(v) > 5:
            raise ValueError('íƒœê·¸ëŠ” ìµœëŒ€ 5ê°œê¹Œì§€')
        return v
```

### 2. Dependency Injector - DI ì»¨í…Œì´ë„ˆ
```python
"""
ì˜ì¡´ì„± ì£¼ì…ì„ ë” ì²´ê³„ì ìœ¼ë¡œ

ì„¤ì¹˜: poetry add dependency-injector
ğŸ”— ê³µì‹ ë¬¸ì„œ: https://python-dependency-injector.ets-labs.org/
"""

from dependency_injector import containers, providers
from repositories import UserRepository
from services import UserService

class Container(containers.DeclarativeContainer):
    """ì˜ì¡´ì„± ì»¨í…Œì´ë„ˆ"""
    
    # DB ì„¸ì…˜
    db = providers.Singleton(SessionLocal)
    
    # Repository
    user_repository = providers.Factory(
        UserRepository,
        db=db
    )
    
    # Service
    user_service = providers.Factory(
        UserService,
        repository=user_repository
    )

# ì‚¬ìš©
container = Container()
user_service = container.user_service()
```

### 3. SQLAlchemy-Utils - ORM í—¬í¼
```python
"""
SQLAlchemyì— ìœ ìš©í•œ ê¸°ëŠ¥ ì¶”ê°€

ì„¤ì¹˜: poetry add sqlalchemy-utils
ğŸ”— ê³µì‹ ë¬¸ì„œ: https://sqlalchemy-utils.readthedocs.io/
"""

from sqlalchemy_utils import EmailType, URLType, UUIDType
from sqlalchemy_utils import PasswordType
import uuid

class User(Base):
    __tablename__ = "users"
    
    # UUID ê¸°ë³¸ í‚¤
    id = Column(UUIDType(binary=False), primary_key=True, default=uuid.uuid4)
    
    # ì´ë©”ì¼ ê²€ì¦
    email = Column(EmailType, unique=True, nullable=False)
    
    # ë¹„ë°€ë²ˆí˜¸ ìë™ í•´ì‹±
    password = Column(PasswordType(schemes=['pbkdf2_sha512']))
    
    # URL ê²€ì¦
    website = Column(URLType)
```

---

## ğŸ’ª ë ˆë²¨ì—… ë„ì „ ê³¼ì œ

### ğŸŒŸ ì´ˆê¸‰ (Day 1-3)
- [ ] ERD ê·¸ë¦¬ê¸° (ë¸”ë¡œê·¸ ì‹œìŠ¤í…œ)
- [ ] Repository íŒ¨í„´ êµ¬í˜„
- [ ] Service Layer ì¶”ê°€

### ğŸŒŸğŸŒŸ ì¤‘ê¸‰ (Day 4-7)
- [ ] Singleton, Factory íŒ¨í„´ ì‹¤ì „ ì ìš©
- [ ] 3ê³„ì¸µ ì•„í‚¤í…ì²˜ ì™„ì„±
- [ ] ìºì‹± ì¶”ê°€ (ë©”ëª¨ë¦¬ ìºì‹œ)

### ğŸŒŸğŸŒŸğŸŒŸ ê³ ê¸‰ (Week 2)
- [ ] Observer íŒ¨í„´ìœ¼ë¡œ ì´ë²¤íŠ¸ ì‹œìŠ¤í…œ
- [ ] Strategy íŒ¨í„´ìœ¼ë¡œ ì•Œë¦¼ ì‹œìŠ¤í…œ
- [ ] ì „ì²´ í”„ë¡œì íŠ¸ ë¦¬íŒ©í† ë§

---

**ë‹¤ìŒ í•™ìŠµ**: [study3.md - í…ŒìŠ¤íŠ¸ & ìœ ì§€ë³´ìˆ˜](./study3.md) ğŸš€
